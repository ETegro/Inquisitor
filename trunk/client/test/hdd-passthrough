#!/bin/sh -e
# NAME=HDD passthrough disk
# DESCRIPTION=HDD passthrough disks test
# DESTROYS_HDD=true
# IS_INTERACTIVE=false
# POWEROFF_DURING_TEST=false
# VERSION=0.1
# TAGS=hdd
# VAR=DISK_GROUP_SIZE:int:8:Number of disks per group for testing

. /usr/share/inquisitor/functions-test

exit_handler()
{
	echo "Here will be code to kill badblocks processes"
}

test_available()
{
	echo "Drivernames: " `get_harddrives_list | perl -npe "s/\n/,/" | \
		sed 's/,$//g'`
	$SHARE_DIR/test/additional/hdd-badblocks.rb `get_harddrives_list | \
		perl -npe "s/\n/ /" | sed 's/ $//g'`
}

raid-wizard-clear
test_available

I=0
while ( raid-wizard-passthrough $DISK_GROUP_SIZE $I ); do
	test_available
	I=$(( $I + 1 ))
done

test_succeeded
